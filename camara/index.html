<!doctype HTML>
<html>

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <!---->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-136675623-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-136675623-1');
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Game disparos</title>


</head>
<!--<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>-->
<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
<!-- <script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script> -->
<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Anton&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<script>
    var isTargetFound = false;
    var interacted = false;
    var dino = null;
    var cuenta = 0;
    AFRAME.registerComponent("markerhandler", {
        init: function () {
            console.log('markerhandler-init');

            markerObj = document.querySelector('a-marker');
            markerObj.hidden = true;

        },

        tick: function () {

            if (markerObj != null) {
                if (markerObj.object3D.visible == true) {

                    if (isTargetFound)
                        return;

                    isTargetFound = true;
                    console.log("marker visible");
                    cuenta++;

                }
                else {

                    if (!isTargetFound)
                        return;

                    isTargetFound = false;
                    console.log("marker invisible");
                }
            }
        }
    });
</script>

<body id="cuerpo" style='margin : 0px; overflow: hidden;'>
    <!-- Stream video via webcam playsinline-->
    <div class="cont-video">
        <video id="video" autoplay></video>
    </div>

    <footer>
        <img src="images/powvector.png" alt="">
    </footer>


    <div id="ventana">
        <div class="contenido">
            <p class="centrar">!Felicidades eres el nuevo GANADOR!</p>
            <p class="centrar">Haz click aqui para registrar tus datos</p>
            <div class="butId">
                <button onClick="abreRegistro()">OK</button>
            </div>
        </div>
    </div>
    <div id="datosGuardados">
        <div class="contenido">
            <p class="centrar">!Felicidades ahora eres el nuevo GANADOR!</p>
            <p id="newWinner" class="centrar yellow strong"></p>
            <p class="centrar">Tus datos se guardaron satisfactoriamente</p>
            <div class="butId">
                <button onClick="play()">OK</button>
            </div>
        </div>
    </div>
    <div id="playAgain">
        <div class="contenido">
            <p class="centrar">Aun no superas el record :(</p>
            <p class="centrar">Intentalo de nuevo!</p>
            <div class="butId">
                <button onClick="play()">Jugar de nuevo</button>
            </div>
        </div>
    </div>
    <div id="espera-hora">
        <div class="contenido">
            <p class="centrar">Ya has jugado</p>
            <p id="tiempoRestante" class="centrar"></p>
            <!-- <div class="butId">
                    <button onClick="play()">Jugar de nuevo</button>  
                </div> -->
        </div>
    </div>
    <div id="suerte">
        <div class="contenido">
            <p class="centrar">Upss no superaste el record :(</p>
            <p class="centrar">Intentalo de nuevo dentro de 1 hora!</p>
            <div class="butId">
                <button onClick="play()">Ok</button>
            </div>
        </div>
    </div>
    <div id="puntuacionBan">
        <div class="contenido2">
            <ul class="inline">
                <li>Balas:</li>
                <li id="balasBan">0</li>
                <li id="tiempoBan">60</li>
                <li>Puntos:</li>
                <li id="puntosBan">0</li>
            </ul>
        </div>
    </div>
    <div id="formulario">
        <div id="for" class="container">
            Ingresa tus datos para contactarte
            <br><br><br>
            <form action="">
                <div class="form-group">
                    <!-- <label for="nombre">NickName:</label> -->
                    <input id="nickId" class="form-control" type="text" placeholder="nickName" maxlength="12">
                </div>
                <div class="form-group">
                    <!-- <label for="nombre">Nombre:</label> -->
                    <input id="nombreId" class="form-control" type="text" placeholder="nombre" maxlength="60">
                </div>
                <div class="form-group">
                    <!-- <label for="nombre">Telefono:</label> -->
                    <input id="telId" class="form-control" type="text" placeholder="telefono" maxlength="20">
                </div>
                <div class="form-group">
                    <!-- <label for="nombre">Mail:</label> -->
                    <input id="mailId" class="form-control" type="text" placeholder="mail" maxlength="60">
                </div>

            </form>
            <button class="btn btn-primary" onClick="sendData()">Enviar</button>
        </div>
    </div>

    <!-- we add detectionMode and matrixCodeType to tell AR.js to recognize barcode markers -->
    <a-scene id="escena">

        <a-entity light="type: ambient; color: #FFF"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: .6" position="-0.5 1 1"></a-entity>

        <!--<a-marker markerhandler emitevents="true" cursor="fuse: false; rayOrigin: mouse" type='pattern' url='pattern-v3.patt'>
                
            </a-marker>-->


        <a-entity id="global" rotation="0 180 0">
            <a-entity id="marPos" rotation="0 0 0">
                <a-entity id="marciano" rotation="0 0 0">
                    <a-box id="cajaId" position=".1 0 -2" rotation="0 0 0" scale=".0003 .0003 .0003"
                        material="src:images/vm.jpg;">
                        <a-animation attribute="rotation" dur="5000" to="0 360 360" repeat="indefinite" easing="linear">
                        </a-animation>
                        <a-animation attribute="scale" begin="anScale" dur="500" to=".001 .001 .001"></a-animation>
                    </a-box>
                    <!---->
                    <a-animation attribute="rotation" dur="80000" to="0 360 0" easing="linear" repeat="50">
                    </a-animation>
                </a-entity>
            </a-entity>
            <!----------------------------------------------------------------->
            <a-entity id="marPos2" rotation="0 90 0">
                <a-entity id="marciano2" rotation="0 0 0">

                    <a-box id="cajaId2" position=".1 0 -2" rotation="0 0 0" scale=".0003 .0003 .0003"
                        material="src:images/pp.png;">
                        <a-animation attribute="rotation" dur="5000" to="0 360 360" repeat="indefinite" easing="linear">
                        </a-animation>
                        <a-animation attribute="scale" begin="anScale" dur="500" to=".001 .001 .001"></a-animation>
                    </a-box>
                    <!---->
                    <a-animation attribute="rotation" dur="80000" to="0 360 0" easing="linear" repeat="50">
                    </a-animation>
                </a-entity>
            </a-entity>
            <!----------------------------------------------------------------->
            <a-entity id="marPos3" rotation="0 180 0">
                <a-entity id="marciano3" rotation="0 0 0">

                    <a-box id="cajaId3" position=".1 0 -2" rotation="0 0 0" scale=".0003 .0003 .0003"
                        material="src:images/vm.jpg;">
                        <a-animation attribute="rotation" dur="5000" to="0 360 360" repeat="indefinite" easing="linear">
                        </a-animation>
                        <a-animation attribute="scale" begin="anScale" dur="500" to=".001 .001 .001"></a-animation>
                    </a-box>
                    <!---->
                    <a-animation attribute="rotation" dur="80000" to="0 360 0" easing="linear" repeat="50">
                    </a-animation>
                </a-entity>
            </a-entity>
            <!----------------------------------------------------------------->
            <a-entity id="marPos4" rotation="0 270 0">
                <a-entity id="marciano4" rotation="0 0 0">

                    <a-box id="cajaId4" position=".1 0 -2" rotation="0 0 0" scale=".0003 .0003 .0003"
                        material="src:images/pp.png;">
                        <a-animation attribute="rotation" dur="5000" to="0 360 360" repeat="indefinite" easing="linear">
                        </a-animation>
                        <a-animation attribute="scale" begin="anScale" dur="500" to=".001 .001 .001"></a-animation>
                    </a-box>
                    <!---->
                    <a-animation attribute="rotation" dur="80000" to="0 360 0" easing="linear" repeat="50">
                    </a-animation>
                </a-entity>
            </a-entity>


            <a-entity id="timeId" text="value: 60;" position="4.7 .8 -2" scale=".00001 .00001 .00001" rotation="0 0 0"
                opacity="0">
                <a-animation attribute="scale" begin="marcadorIn" dur="1000" to="10 10 10" easing="linear">
                </a-animation>
            </a-entity>
            <a-entity position="0 -.5 0">
                <a-entity id="textId" text="value: Puntaje: 0;" position=".4 0 -.5" scale=".0001 .0001 .0001"
                    rotation="0 0 0" opacity="0">
                    <a-animation attribute="scale" begin="marcadorIn" dur="1000" to="1 1 1" easing="linear">
                    </a-animation>
                </a-entity>

                <a-entity id="textRecord" text="value: Record: Ricardo     Puntaje: 250;" position=".1 .29 -1"
                    scale=".00008 .00008 .00008" rotation="0 0 0">
                    <a-animation attribute="scale" begin="marcadorIn" dur="1000" to=".8 .8 .8" easing="linear">
                    </a-animation>
                </a-entity>
                <a-plane id="record" position="0 .3 -1.1" height=".15" width=".7" material="src:images/record.png"
                    opacity="0">
                    <a-animation attribute="opacity" begin="marcadorIn" dur="1000" to=".8" easing="linear">
                    </a-animation>
                </a-plane>


                <a-plane id="puntuacion" position="0 0 -1.1" width=".8" height=".44" opacity="0"
                    material="src: images/puntuacion.png">
                    <a-animation attribute="opacity" begin="marcadorIn" dur="1000" to=".5" easing="linear">
                    </a-animation>
                </a-plane>
            </a-entity>






            <a-entity id="logo" position="0 .3 -1" scale="1 1 1" rotation="0 0 0">
                <a-sphere position="0 1 0" radius=".125" material="color: yellow;"></a-sphere>
                <a-entity>
                    <a-ring position="0 1 0" radius-inner=".15" radius-outer=".2" rotation="-80 0 0"
                        material="color:red;" opacity=".5"></a-ring>
                    <a-ring position="0 1 0" radius-inner=".2" radius-outer=".25" rotation="-80 0 0"
                        material="color:yellow;" opacity=".5"></a-ring>

                    <a-ring position="0 .99 0" radius-inner=".15" radius-outer=".2" rotation="100 0 0"
                        material="color:red;" opacity=".5"></a-ring>
                    <a-ring position="0 .99 0" radius-inner=".2" radius-outer=".25" rotation="100 0 0"
                        material="color:yellow;" opacity=".5"></a-ring>
                    <a-animation attribute="rotation" dur="3000" to="0 360 0" repeat="indefinite" easing="linear">
                    </a-animation>
                </a-entity>
                <a-entity>
                    <a-plane position="0 .7 0" rotation="0 0 0" width="1.18" height=".18"
                        material="src:images/logopp.png" opacity=".7"></a-plane>
                    <a-plane position="0 .7 -.1" rotation="0 180 0" width="1.18" height=".18"
                        material="src:images/logopp.png" opacity=".7"></a-plane>
                    <a-animation attribute="rotation" begin="7000" dur="1000" to="0 360 0" repeat="indefinite">
                    </a-animation>
                </a-entity>

            </a-entity>

            <a-plane id="continuar" position="0 0 -1" width=".4" height=".2" opacity=".9"
                material="src: images/continuar.png">
                <a-animation attribute="position" begin="continuarOut" dur="100" to="500 500 500" easing="linear">
                </a-animation>
            </a-plane>


            <a-plane id="inst" position="0 .5 -1" rotation="0 .1 0" width="1.1" height=".5" opacity=".8"
                material="src: images/inst1.png">
                <a-animation attribute="position" begin="continuarOut" dur="100" to="500 500 500" easing="linear">
                </a-animation>
            </a-plane>
        </a-entity>






        <!--
                    <a-box id="balaId" rotation="2 0 0" position="0 -.01 -.2" scale=".01 .01 20" material="color:yellow"></a-box>
                    <a-plane id="plane" position="0 0 -.098" width="2" height="2" material="color:black;" opacity=".4">
                    <a-animation
                        attribute="opacity"
                        begin="planeout"
                        dur="1000"
                        to="0"
                    ></a-animation>
                </a-plane>
                <a-plane id="qr" position="0 0 -.097" width=".02" height=".02" material="src:images/enfoca.png;" opacity=".9">
                    <a-animation
                        attribute="opacity"
                        begin="qrout"
                        dur="1000"
                        to="0"
                    ></a-animation>
                </a-plane>
            
            -->
        <a-entity camera look-controls>

            <a-plane position="0 0 -.1" width=".01" height=".01" opacity=".5" material="src: images/mirilla.png">
            </a-plane>



            <a-plane id="crashId" position="0 0 -.049" width=".001" height=".001" opacity="0" material="color:yellow;">
                <a-animation attribute="opacity" begin="anCrash" dur="100" from="1" to="0"></a-animation>
            </a-plane>

            <a-entity cursor position="0 0 -.5" geometry="primitive: ring; radiusInner: 0.002; radiusOuter: 0.003;"
                material="color: red; shader: flat">
            </a-entity>
            <a-gltf-model src="modelos/gun/scene.gltf" position=".1 -.1 -1" rotation="-5 190 0" scale=".1 .1 .1">
                <a-animation attribute="rotation" dur="1000" to="-3.5 190 0" repeat="indefinite" easing="linear"
                    direction="alternate"></a-animation>
            </a-gltf-model>
            <!-- <a-plane id="newrecord" position="500 500 500" width=".019" height=".015"
                    material="src:images/newrecord.png" opacity=".8">
                    <a-animation attribute="position" dur="100" begin="newRecordIn" to="0 0 -0.07"></a-animation>
                </a-plane> -->



            <!-- <a-plane id="clickZone" position="0 0 -.99" width="20" height="20" opacity="0"></a-plane> -->




            <!--<a-entity id="timId" text="value: 600;" position="5 .6 -3" scale="10 10 10" rotation="0 0 0"></a-entity>-->

        </a-entity>




    </a-scene>


    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>
    <script>
        var matchBala = 0;
        var matchBala2 = 0;
        var matchBala3 = 0;
        var matchBala4 = 0;
        var crash = document.getElementById("crashId");
        var caja = document.getElementById("cajaId");
        var caja2 = document.getElementById("cajaId2");
        var caja3 = document.getElementById("cajaId3");
        var caja4 = document.getElementById("cajaId4");
        var scoreLocal = 0;
        var puntajeRepetido = 0;
        var tiempo = 600;
        var tiempoAgotado = 0;
        var alter = 0;
        var continuar = document.getElementById("continuar");
        var balaCont = 0;
        var nombreGanador = "Buscando";
        var recordGanador = 0;
        var accept = 0;
        var newRecord = 0;
        var juegoIniciado = 0;
        var numBalas = 30;




        let fecha = new Date();
        let anoStart = fecha.getFullYear();
        let mesStart = fecha.getMonth();
        let diaStart = fecha.getDate();
        let horaStart = fecha.getHours();
        let minutoStart = fecha.getMinutes();

        let anoAlmacenado = parseInt(localStorage.getItem("anoStart"));
        let mesAlmacenado = parseInt(localStorage.getItem("mesStart"));
        let diaAlmacenado = parseInt(localStorage.getItem("diaStart"));
        let horaAlmacenado = parseInt(localStorage.getItem("horaStart"));
        let minutoAlmacenado = parseInt(localStorage.getItem("minutoStart"));

        let puedeJugar = 0;
        let tiempoTranscurrido = 0;
        let timeToPlay = 0;
        let secondsToPlay = 59;


        if (!anoAlmacenado) {
            console.log("no hay datos guardados");

            puedeJugar = 1;
        } else {
            if ((anoAlmacenado > anoStart) || (mesAlmacenado > mesStart) || (diaAlmacenado > diaStart) || (horaAlmacenado > (horaStart + 1))) {
                puedeJugar = 1;

            } else {
                let horaAlmacenadoMin = (horaAlmacenado * 60) + minutoAlmacenado;
                let horaStartMin = (horaStart * 60) + minutoStart;
                console.log("hora en min almac: " + horaAlmacenadoMin + "  hora en min start: " + horaStartMin);
                tiempoTranscurrido = horaStartMin - horaAlmacenadoMin;
                timeToPlay = 59 - tiempoTranscurrido;
                if (tiempoTranscurrido > 60) {
                    puedeJugar = 1;

                } else {
                    console.log("espera una hora :(");
                    document.getElementById("espera-hora").style.display = "flex";
                    document.getElementById('escena').style.display = 'none';
                    var countdown = window.setInterval(function (e) {
                        secondsToPlay--;
                        if (secondsToPlay <= 0) {
                            secondsToPlay = 59;
                            timeToPlay--;
                        }
                        if (timeToPlay <= -1) {
                            puedeJugar = 1;

                            document.getElementById("espera-hora").style.display = "none";
                            document.getElementById('escena').style.display = 'block';
                            clearInterval("countdown");
                        }

                        document.getElementById("tiempoRestante").innerHTML = "Espera " + timeToPlay + ":" + secondsToPlay + " para jugar de nuevo :)";
                    }, 1000);
                }
            }
        }




        //console.log("Horas: " + fecha.getHours() + "Minutos: " + fecha.getMinutes());

        ///////FIREBASE//////////////////////////////////////////////////////
        var firebaseConfig = {
            apiKey: "AIzaSyBz-0SRk-8mYCqJUGTUw9zmQipko28M5jc",
            authDomain: "ganador-e6710.firebaseapp.com",
            databaseURL: "https://ganador-e6710.firebaseio.com",
            projectId: "ganador-e6710",
            storageBucket: "ganador-e6710.appspot.com",
            messagingSenderId: "384533878152",
            appId: "1:384533878152:web:17c54f184e7a88ba"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var datos = firebase.database().ref("ganador");
        document.getElementById("balasBan").innerHTML = numBalas;

        function arrayJSON(nombre, telefono, email, nickname, score) {
            var data = {
                nombre: nombre,
                telefono: telefono,
                email: email,
                nickname: nickname,
                score: score
            }
            return data;
        }
        function abreRegistro() {
            console.log("clickbutton");
            if (newRecord) {
                console.log("Haciendo click en el nuevo record2...")
                document.getElementById("ventana").style.display = "none";
                document.getElementById("formulario").style.display = "flex";
            }
        }
        function play() {
            location.reload();
        }

        /////////////////////////////////////////////////////////////////////////////////

        var task = firebase.database().ref("ganador").once("value").then(function (dat) {
            nicknameGanador = dat.val().nickname;
            recordGanador = dat.val().score;
            console.log("Ganador Actual: " + nicknameGanador);
            console.log("puntaje: " + recordGanador);
            document.getElementById("textRecord").setAttribute("text", { value: " Record: " + nicknameGanador + "     Puntaje: " + recordGanador });

        });
        console.log("base de datos");

        function aleat(min, max) {
            return (Math.random() * (max - min) + min);
        }
        document.getElementById("cuerpo").addEventListener("touchstart", function (e) {

            crash.emit("anCrash");
            if (juegoIniciado) {
                numBalas -= 1;
            }

            document.getElementById("balasBan").innerHTML = numBalas;
            if (numBalas <= 0) {
                tiempo = 0;
                juegoIniciado = 0;
            }
            console.log("crash");

            if (balaCont == 1) {
                localStorage.setItem("anoStart", anoStart);
                localStorage.setItem("mesStart", mesStart);
                localStorage.setItem("diaStart", diaStart);
                localStorage.setItem("horaStart", horaStart);
                localStorage.setItem("minutoStart", minutoStart);

                juegoIniciado = 1;
                document.getElementById("textId").emit("marcadorIn");
                document.getElementById("timeId").emit("marcadorIn");
                document.getElementById("puntuacion").emit("marcadorIn");
                document.getElementById("record").emit("marcadorIn");
                document.getElementById("textRecord").emit("marcadorIn");
                document.getElementById("inst").emit("continuarOut");
                document.getElementById("continuar").emit("continuarOut");
                tiempo = 60;
                caja.setAttribute("scale", { x: .3, y: .3, z: .3 });
                caja2.setAttribute("scale", { x: .3, y: .3, z: .3 });
                caja3.setAttribute("scale", { x: .3, y: .3, z: .3 });
                caja4.setAttribute("scale", { x: .3, y: .3, z: .3 });
                //document.getElementById("marciano").emit("cajaRot");
            }
            if (matchBala == 1) {
                console.log("disparo certero");
                //document.getElementById("cajaId").setAttribute("material",{color:"blue"});

                caja.emit("anScale");
                puntajeRepetido = 1;
                /**/
                window.setTimeout(function (e) {
                    var posComY = aleat(-2, 2);
                    //posComY-=1;
                    var posComZ = aleat(-3.5, -2);
                    //posComZ=-posComZ;
                    var rotY = aleat(-360, 360);
                    //console.log("rotacion: "+rotY);
                    document.getElementById("marPos").setAttribute("rotation", { x: 0, y: rotY, z: 0 });
                    if (tiempoAgotado == 0) {
                        caja.setAttribute("scale", { x: .3, y: .3, z: .3 });
                        console.log("aparece");
                        if (alter == 0) {
                            caja.setAttribute("material", { src: "images/pp.png" });
                            alter = 1;
                            console.log("pizza");
                        } else {
                            caja.setAttribute("material", { src: "images/vm.jpg" });
                            alter = 0;
                            console.log("vm");
                        }


                    }

                    caja.setAttribute("position", { x: 0, y: posComY, z: posComZ });
                }, 1000);
            }
            //-------------------------------------------------------------------------------
            if (matchBala2 == 1) {
                console.log("disparo certero");
                //document.getElementById("cajaId").setAttribute("material",{color:"blue"});

                caja2.emit("anScale");
                puntajeRepetido = 1;
                /**/
                window.setTimeout(function (e) {
                    var posComY = aleat(-2, 2);
                    //posComY-=1;
                    var posComZ = aleat(-3.5, -2);
                    //posComZ=-posComZ;
                    var rotY = aleat(-360, 360);
                    //console.log("rotacion: "+rotY);
                    document.getElementById("marPos2").setAttribute("rotation", { x: 0, y: rotY, z: 0 });
                    if (tiempoAgotado == 0) {
                        caja2.setAttribute("scale", { x: .3, y: .3, z: .3 });
                        console.log("aparece");
                        if (alter == 0) {
                            caja2.setAttribute("material", { src: "images/pp.png" });
                            alter = 1;
                            console.log("pizza");
                        } else {
                            caja2.setAttribute("material", { src: "images/vm.jpg" });
                            alter = 0;
                            console.log("vm");
                        }


                    }

                    caja2.setAttribute("position", { x: 0, y: posComY, z: posComZ });
                }, 1000);
            }
            //-------------------------------------------------------------------------------
            if (matchBala3 == 1) {
                console.log("disparo certero");
                //document.getElementById("cajaId").setAttribute("material",{color:"blue"});

                caja3.emit("anScale");
                puntajeRepetido = 1;
                /**/
                window.setTimeout(function (e) {
                    var posComY = aleat(-2, 2);
                    //posComY-=1;
                    var posComZ = aleat(-3.5, -2);
                    //posComZ=-posComZ;
                    var rotY = aleat(-360, 360);
                    //console.log("rotacion: "+rotY);
                    document.getElementById("marPos3").setAttribute("rotation", { x: 0, y: rotY, z: 0 });
                    if (tiempoAgotado == 0) {
                        caja3.setAttribute("scale", { x: .3, y: .3, z: .3 });
                        console.log("aparece");
                        if (alter == 0) {
                            caja3.setAttribute("material", { src: "images/pp.png" });
                            alter = 1;
                            console.log("pizza");
                        } else {
                            caja3.setAttribute("material", { src: "images/vm.jpg" });
                            alter = 0;
                            console.log("vm");
                        }


                    }

                    caja3.setAttribute("position", { x: 0, y: posComY, z: posComZ });
                }, 1000);
            }
            //-------------------------------------------------------------------------------
            if (matchBala4 == 1) {
                console.log("disparo certero");
                //document.getElementById("cajaId").setAttribute("material",{color:"blue"});

                caja4.emit("anScale");
                puntajeRepetido = 1;
                /**/
                window.setTimeout(function (e) {
                    var posComY = aleat(-2, 2);
                    //posComY-=1;
                    var posComZ = aleat(-3.5, -2);
                    //posComZ=-posComZ;
                    var rotY = aleat(-360, 360);
                    //console.log("rotacion: "+rotY);
                    document.getElementById("marPos4").setAttribute("rotation", { x: 0, y: rotY, z: 0 });
                    if (tiempoAgotado == 0) {
                        caja4.setAttribute("scale", { x: .3, y: .3, z: .3 });
                        console.log("aparece");
                        if (alter == 0) {
                            caja4.setAttribute("material", { src: "images/pp.png" });
                            alter = 1;
                            console.log("pizza");
                        } else {
                            caja4.setAttribute("material", { src: "images/vm.jpg" });
                            alter = 0;
                            console.log("vm");
                        }


                    }

                    caja4.setAttribute("position", { x: 0, y: posComY, z: posComZ });
                }, 1000);
            }
            //-------------------------------------------------------------------------------
        });

        caja.addEventListener("mouseenter", function (e) {
            matchBala = 1;

            console.log("enter");
            //document.getElementById("cajaId").setAttribute("material",{color:"blue"});
        });
        caja.addEventListener("mouseleave", function (e) {
            matchBala = 0;
            console.log("leave");
            //document.getElementById("cajaId").setAttribute("material",{color:"red"});
        });
        //////////////////////////
        caja2.addEventListener("mouseenter", function (e) {
            matchBala2 = 1;

            console.log("enter");
            //document.getElementById("cajaId").setAttribute("material",{color:"blue"});
        });
        caja2.addEventListener("mouseleave", function (e) {
            matchBala2 = 0;
            console.log("leave");
            //document.getElementById("cajaId").setAttribute("material",{color:"red"});
        });
        //////////////////////////
        caja3.addEventListener("mouseenter", function (e) {
            matchBala3 = 1;
            console.log("enter");
            //document.getElementById("cajaId").setAttribute("material",{color:"blue"});
        });
        caja3.addEventListener("mouseleave", function (e) {
            matchBala3 = 0;
            console.log("leave");
            //document.getElementById("cajaId").setAttribute("material",{color:"red"});
        });
        //////////////////////////
        caja4.addEventListener("mouseenter", function (e) {
            matchBala4 = 1;
            console.log("enter");
            //document.getElementById("cajaId").setAttribute("material",{color:"blue"});
        });
        caja4.addEventListener("mouseleave", function (e) {
            matchBala4 = 0;
            console.log("leave");
            //document.getElementById("cajaId").setAttribute("material",{color:"red"});
        });
        //////////////////////////
        continuar.addEventListener("mouseenter", function (e) {
            balaCont = 1;
            if (!puedeJugar) {
                balaCont = 0;
            }
            console.log("enter");
            //document.getElementById("cajaId").setAttribute("material",{color:"blue"});
        });
        continuar.addEventListener("mouseleave", function (e) {
            balaCont = 0;
            console.log("leave");
            //document.getElementById("cajaId").setAttribute("material",{color:"red"});
        });

        window.setInterval(function (e) {
            if (puntajeRepetido == 1) {
                scoreLocal += 10;
                document.getElementById("textId").setAttribute("text", { value: "Puntaje: " + scoreLocal });
                document.getElementById("puntosBan").innerHTML = scoreLocal;
                puntajeRepetido = 0;
            }

        }, 900);
        var tiempoInterval = window.setInterval(function (e) {
            tiempo--;

            if (tiempo >= 0) {
                document.getElementById("timeId").setAttribute("text", { value: "" + tiempo });
                if (juegoIniciado) {
                    document.getElementById("tiempoBan").innerHTML = tiempo;
                }
            } else {
                tiempoAgotado = 1;
                caja.setAttribute("scale", { x: .0001, y: .0001, z: .0001 });
                caja2.setAttribute("scale", { x: .0001, y: .0001, z: .0001 });
                caja3.setAttribute("scale", { x: .0001, y: .0001, z: .0001 });
                caja4.setAttribute("scale", { x: .0001, y: .0001, z: .0001 });

                if (scoreLocal > parseInt(recordGanador)) {
                    console.log("scoreLocal: " + scoreLocal);
                    console.log("recordGanador:" + recordGanador);
                    if (accept == 0) {
                        document.getElementById("timeId").setAttribute("text", { value: "Nuevo record!" });
                        document.getElementById('ventana').style.display = 'flex';
                        document.getElementById('escena').style.display = 'none';
                        //document.getElementById("newrecord").emit("newRecordIn");
                        newRecord = 1;
                        console.log("Nuevo record");
                        accept = 1;
                    }

                } else {
                    console.log("quieres jugar de nuevo?");
                    //document.getElementById("playAgain").style.display = "flex";
                    document.getElementById("suerte").style.display = "flex";
                    document.getElementById('escena').style.display = 'none';
                }
                clearInterval("tiempoInterval");
            }

        }, 1001);




        function sendData() {
            console.log("dato enviandose");
            firebase.database().ref("ganador").once("value").then(function (data) {
                console.log("valorActual: " + data.val().score);
                var valact = parseInt(data.val().score);
                /**/
                if (scoreLocal > valact) {
                    var nick = document.getElementById("nickId").value;
                    var nombre = document.getElementById("nombreId").value;
                    var mail = document.getElementById("mailId").value;
                    var tel = document.getElementById("telId").value;

                    console.log(nick + nombre + mail + tel);
                    var arrayData = arrayJSON(nombre, tel, mail, nick, scoreLocal);
                    datos.set(arrayData);
                    //alert("Tus datos se han guardado!");
                    document.getElementById("newWinner").innerHTML = nick;
                    document.getElementById("formulario").style.display = "none";
                    document.getElementById("datosGuardados").style.display = "flex";

                } else {
                    //alert("Ahora ya hay un puntaje mas alto, intentalo de nuevo");
                }

            });


        }

    </script>
    <script src="codigo.js"></script>
</body>

</html>