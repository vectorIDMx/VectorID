<!doctype HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    </head>
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="scripts/multisrc.js"></script>
    <script>
      var isTargetFound = false;
      var cuenta = 0;
        AFRAME.registerComponent("markerhandler",{
                init:function() {
                    console.log('markerhandler-init');

                   markerObj = document.querySelector('a-marker');
                   markerObj.hidden = true;

                   //dino.setAttribute('animation-mixer', {clip: 'C4D Animation Take', loop: 'repeat'});
                },

                tick:function() {

                    if (markerObj != null)
                        {
                            if (markerObj.object3D.visible == true) {
                                
                              if (isTargetFound)
                                return;

                              isTargetFound = true;
                              console.log ("marker visible");
                              document.getElementById("modeloId").emit("anCrece");
                              document.getElementById("cilindroId").emit("an");
                              cuenta++;
                              if(cuenta==1)
                              {
                                document.getElementById("qr").emit("qrout"); 
                                document.getElementById("plane").emit("planeout");
                                document.getElementById("modeloId").emit("an1");
                               // document.getElementById("pantalla").emit("anPantalla");
                                //robot.setAttribute("animation-mixer",{timeScale:1});
                                
                              }
                              //window.reproducir();
                              //document.getElementById("videoScene").emit("an1");
                            }
                            else {
                                
                              if (!isTargetFound)
                                return;

                              isTargetFound = false;
                            console.log ("marker invisible");
                            //window.pausar();
                            }
                          }
                  }
                });
    </script>
    <body id="cuerpo" style='margin : 0px; overflow: hidden;'>
            
        <!-- we add detectionMode and matrixCodeType to tell AR.js to recognize barcode markers -->
        <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; patternRatio: 0.8;'>
            <a-assets>

                <img id="mensaje" src="images/cinta.png">
                    <img id="nada" src="images/nada.png">
                    
            </a-assets>
            <a-entity light="type: ambient; color: #FFF"></a-entity>
            <a-entity light="type: directional; color: #FFF; intensity: 5" position="1 0 1"></a-entity>
            <a-entity light="type: directional; color: #FFF; intensity: 5" position="-1 -.5 1"></a-entity>

            

            <a-marker markerhandler emitevents="true" cursor="fuse: false; rayOrigin: mouse" type='pattern' url='pattern-qr_pm.patt'>

                
              <!--<a-cylinder position="0 1 0" id="modeloId" radius=".5" height="1.5" material="src:images/etiqueta.png;"></a-cylinder>-->
              
              <!---->
              <a-entity id="escena" position=".6 0 0">
                <a-entity rotation="0 0 20">
                  <a-cylinder id="cilindroId" position="0 2 0" rotation="0 360 0" radius="1" height=".8" multisrc="srcs:#mensaje,#nada,#nada" opacity=".01">
                    <a-animation
                      attribute="rotation"
                      dur="8000"
                      to="0 0 0"
                      repeat="indefinite"
                      easing=linear
                    ></a-animation>
                    <a-animation
                        attribute="opacity"
                        begin="an"
                        dur="3500"
                        from=".01"
                        to=".9"
                      ></a-animation>
                  </a-cylinder>
                </a-entity>
                

                <a-entity>
                  <a-entity rotation="0 0 20">
                  <a-gltf-model id="modeloId" rotation="0 0 0" src="modelos/pepsi/scene.gltf" position="0 .2 0" scale=".000003 .000003 .000003" animation-mixer>
                    <a-animation
                      attribute="rotation"
                      begin="an1"
                      dur="10000"
                      to="0 360 0"
                      repeat="indefinite"
                      easing="linear"
                    ></a-animation> 
                    
                    <a-animation
                      attribute="scale"
                      begin="anCrece"
                      dur="700"
                      from=".000001 .000001 .000001"
                      to=".008 .008 .008"
                      easing="linear"
                    ></a-animation>
                  </a-gltf-model>
                  
                </a-entity>
                  <a-animation
                      attribute="position"
                      dur="2000"
                      to="0 .4 0"
                      easing="linear"
                      repeat="indefinite"
                      direction="alternate"
                    ></a-animation>
                </a-entity>
              </a-entity>
              
              
              
              <!--<a-plane rotation="-90 0 0" width="5" height="5" material="src:images/nada.png"></a-plane>-->
              
           
            </a-marker>

            <a-plane  position="-.01 -.03 -.1" width=".02" height=".006" opacity=".3"
                material="src: images/powvector.png"></a-plane>
                <a-plane id="plane" position="0 0 -.098" width="2" height="2" material="color:black;" opacity=".4">
                    <a-animation
                        attribute="opacity"
                        begin="planeout"
                        dur="1000"
                        to="0"
                    ></a-animation>
                </a-plane>
                <a-plane id="qr" position="0 0 -.097" width=".02" height=".02" material="src:images/enfoca.png;" opacity=".9">
                    <a-animation
                        attribute="opacity"
                        begin="qrout"
                        dur="1000"
                        to="0"
                    ></a-animation>
                </a-plane>

            <!-- use this <a-entity camera> to support multiple-markers, otherwise use <a-marker-camera> instead of </a-marker> -->
            <a-entity camera></a-entity>
        </a-scene>
        
    </body>
    <script>
      document.getElementById("cuerpo").addEventListener("click", function(e)
      {
        alert("some nigga has clicked .i.");
      });
      


    </script>


</html>