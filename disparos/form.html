<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Ingresa datos</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
    <div class="container">
            Ingresa tus datos para contactarte
            <br><br><br>
        <form action="">
            <div class="form-group">
                <label for="nombre">NickName:</label>
                <input id="nickId" class="form-control" type="text" placeholder="nickName">
            </div>
            <div class="form-group">
                <label for="nombre">Nombre:</label>
                <input id="nombreId" class="form-control" type="text" placeholder="nombre">
            </div>
            <div class="form-group">
                <label for="nombre">Telefono:</label>
                <input id="telId" class="form-control" type="text" placeholder="telefono">
            </div>
            <div class="form-group">
                <label for="nombre">Mail:</label>
                <input id="mailId" class="form-control" type="text" placeholder="mail">
            </div>
            
        </form>
        <button class="btn btn-primary" onClick="sendData()">Enviar</button>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>
<script>
    var aproved=0;

    var firebaseConfig = {
      apiKey: "AIzaSyBz-0SRk-8mYCqJUGTUw9zmQipko28M5jc",
      authDomain: "ganador-e6710.firebaseapp.com",
      databaseURL: "https://ganador-e6710.firebaseio.com",
      projectId: "ganador-e6710",
      storageBucket: "ganador-e6710.appspot.com",
      messagingSenderId: "384533878152",
      appId: "1:384533878152:web:17c54f184e7a88ba"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var datos = firebase.database().ref("ganador");
    var paramstr = window.location.search.substr(1);
    var paramarr = paramstr.split ("&");
    var params = {};
    var score=0;

    for ( var i = 0; i < paramarr.length; i++) {
        var tmparr = paramarr[i].split("=");
        params[tmparr[0]] = tmparr[1];
    }
    if (params['qw']) {
    console.log('El valor del parámetro variable es: '+params['qw']);
    score=params['qw'];
    } else {
    console.log('No se envió el parámetro variable');
    }

    if (params['val']) {
    console.log('El valor del parámetro variable es: '+params['val']);
    var validacion = ((params['val']-7)*2)/5;
    console.log(validacion);
    if(validacion == score)
    {
        aproved=1;
    }
    } else {
    console.log('No se envió el parámetro variable');
    }

    function arrayJSON(nombre, telefono, email,nickname,score)
    {
        var data = {
            nombre: nombre,
            telefono: telefono,
            email: email,
            nickname: nickname,
            score: score
        }
        return data;
    }
    function sendData()
    {
        /**/
        //console.log("mensaje enviado");
        if(aproved)
        {   
            firebase.database().ref("ganador").once("value").then(function(data)
            {
                console.log("valorActual: "+data.val().score);
                var valact = parseInt(data.val().score);
                /**/
                if(score > valact)
                {
                    var nick = document.getElementById("nickId").value;
                    var nombre = document.getElementById("nombreId").value;
                    var mail = document.getElementById("mailId").value;
                    var tel = document.getElementById("telId").value;

                    console.log(nick +nombre+mail+tel);

                    var arrayData = arrayJSON(nombre,tel,mail,nick,score);
                    datos.set(arrayData);
                    alert("Tus datos se han guardado!");
                    window.close();
                }else{
                    alert("Ahora ya hay un puntaje mas alto, intentalo de nuevo");
                }
                
            });

             
        }else{
            alert("Accion no permitida! Debes jugar y superar el record");
        }
        

    }

    

    
    
</script>

</html>